<header class="bg-white border-b border-gray-200 w-full">
    <nav class="flex items-center justify-between bg-blue-800 text-white px-4 py-2 w-full">

        <!-- Botón hamburguesa a la izquierda -->
        <button (click)="toggleSidebar.emit()" type="button" class="inline-flex items-center w-10 h-10 justify-center text-gray-100 rounded-lg hover:bg-blue-400 focus:outline-none focus:ring-2 focus:ring-blue-200">
      <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
        <path fill-rule="evenodd"
          d="M2 4.75A.75.75 0 012.75 4h14.5a.75.75 0 010 1.5H2.75A.75.75 0 012 4.75zm0 10.5a.75.75 0 01.75-.75h7.5a.75.75 0 010 1.5h-7.5a.75.75 0 01-.75-.75zM2 10a.75.75 0 01.75-.75h14.5a.75.75 0 010 1.5H2.75A.75.75 0 012 10z" />
      </svg>
    </button>

        <!-- 🔍 Buscador + Carrito a la derecha -->
        <div *ngIf="isHome" class="flex items-center gap-3 ml-auto">

            <!-- Contenedor del buscador -->
            <div class="relative search-container flex items-center transition-all duration-300" [ngClass]="{ 'w-64': showSearch, 'w-10': !showSearch }">

                <!-- 🔍 Botón lupa (flat style) -->
                <button (click)="toggleSearch()" type="button" class="absolute left-0 flex items-center justify-center w-10 h-10 rounded-full transition" [ngClass]="showSearch ? 'hover:bg-transparent' : 'hover:bg-blue-400'">

          <!-- SVG del icono -->
          <svg class="w-5 h-5 transition-colors duration-300" [attr.fill]="showSearch ? '#374151' : '#ffffff'"
            viewBox="0 0 512 512">
            <path
              d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208z" />
          </svg>
        </button>


                <!-- Input -->
                <input *ngIf="showSearch" appAutoFocus type="search" name="search" placeholder="Buscar producto..." [(ngModel)]="searchTerm" (input)="onSearchChange()" class="pl-10 pr-2 py-2 w-full text-sm text-gray-900 border border-gray-400 rounded-lg bg-white focus:ring-blue-500 focus:border-blue-500 transition-all duration-300"
                />
            </div>

            <!-- 🛒 Carrito -->
            <a routerLink="/cart" class="relative w-10 h-10 flex items-center justify-center rounded-lg hover:bg-blue-400 focus:ring-2 focus:ring-blue-200">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 576 512">
          <path
            d="M0 24C0 10.7 10.7 0 24 0L69.5 0c22 0 41.5 12.8 50.6 32h411c26.3 0 45.5 25 38.6 50.4l-41 152.3c-8.5 31.4-37 53.3-69.5 53.3h-288.5l5.4 28.5c2.2 11.3 12.1 19.5 23.6 19.5H488c13.3 0 24 10.7 24 24s-10.7 24-24 24h-288.3c-34.6 0-64.3-24.6-70.7-58.5L77.4 54.5c-.7-3.8-4-6.5-7.9-6.5H24C10.7 48 0 37.3 0 24zm128 440a48 48 0 1 1 96 0 48 48 0 1 1 -96 0zm336-48a48 48 0 1 1 0 96 48 48 0 1 1 0-96z" />
        </svg>
                <span *ngIf="totalItems > 0" class="absolute -top-1 -right-1 text-xs bg-red-600 text-white rounded-full px-1">
          {{ totalItems }}
        </span>
            </a>
        </div>

        <!--
        <div class="flex items-center gap-4">
             Si hay usuario logueado 
        <ng-container *ngIf="user$ | async as user; else guest">
            <span class="text-gray-800 font-semibold">
          👋 Hola, {{ user.usuario || user.nombre }}
        </span>
            <button (click)="logout()" class="text-sm text-red-500 hover:underline">Cerrar sesión</button>
        </ng-container>

         Si NO hay usuario 
            <ng-template #guest>
                <a routerLink="/cart" class="text-yellow-600 hover:underline font-medium">Iniciar sesión</a>
            </ng-template>
        </div>
        -->

        <!-- Si el usuario está autenticado -->
        <!--
    <div *ngIf="user$ | async as user; else guest" class="relative user-menu">
      <button type="button" (click)="toggleMenu()"
        class="relative inline-flex items-center justify-center w-10 h-10 overflow-hidden bg-gray-100 rounded-full dark:bg-gray-600">
        <span class="font-medium text-gray-600 dark:text-gray-300">
          {{ user.nombre | iniciales }}
        </span>
      </button>

      <div *ngIf="showMenu"
        class="absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-gray-200 dark:bg-gray-800 dark:border-gray-700 z-50">
        <div class="px-4 py-3 text-sm text-gray-700 dark:text-gray-200">
          <p class="font-semibold">{{ user.nombre }}</p>
          <p class="text-xs text-gray-500 dark:text-gray-400">{{ user.usuario }}</p>
        </div>
        <hr class="border-gray-200 dark:border-gray-700" />
        <button (click)="logout()"
          class="w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700">
          Cerrar sesión
        </button>
      </div>
    </div>
-->
        <!-- Usuario autenticado -->
        <div class="relative user-menu">
            <!-- Botón avatar -->
            <button (click)="toggleMenu()" type="button" class="relative flex items-center justify-center w-10 h-10 bg-white text-blue-800 font-bold rounded-full border-2 border-blue-600 shadow-sm hover:shadow-md hover:scale-105 transition-all duration-200" title="Menú de usuario">
    <ng-container *ngIf="user$ | async as user; else guestIcon">
      {{ user.nombre | iniciales }}
    </ng-container>

    <!-- Ícono por defecto cuando no hay usuario -->
    <ng-template #guestIcon>
      <svg
        class="w-5 h-5 text-blue-800"
        xmlns="http://www.w3.org/2000/svg"
        fill="none"
        viewBox="0 0 24 24"
        stroke="currentColor"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M5.121 17.804A13.937 13.937 0 0112 15c2.485 0 4.797.597 6.879 1.652M15 11a3 3 0 11-6 0 3 3 0 016 0z"
        />
      </svg>
    </ng-template>
  </button>

            <!-- Dropdown -->
            <div *ngIf="showMenu" class="absolute right-0 mt-3 w-48 bg-white rounded-xl shadow-lg border border-gray-100 py-2 z-50 animate-fade-in">
                <!-- Si está autenticado -->
                <ng-container *ngIf="user$ | async as user; else guestMenu">
                    <div class="px-4 py-2 border-b text-sm text-gray-700 font-medium">
                        <p>{{ user.nombre }}</p>
                        <p class="text-xs text-gray-500">{{ user.usuario }}</p>
                    </div>
                    <button (click)="logout()" class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-blue-50 hover:text-blue-700">
        Cerrar sesión
      </button>
                </ng-container>

                <!-- Si NO está autenticado -->
                <ng-template #guestMenu>
                    <ul class="text-sm text-gray-700">
                        <li>
                            <a (click)="openLogin('login'); showMenu = false; $event.stopPropagation()" class="block px-4 py-2 hover:bg-blue-50 hover:text-blue-700 cursor-pointer">
            Iniciar sesión
          </a>
                        </li>
                        <li>
                            <a (click)="openLogin('register'); showMenu = false; $event.stopPropagation()" class="block px-4 py-2 hover:bg-blue-50 hover:text-blue-700 cursor-pointer">
            Crear cuenta
          </a>
                        </li>
                    </ul>
                </ng-template>
            </div>
        </div>

    </nav>
</header>
<app-login [show]="showAuthModal" [activeTab]="activeTab" (close)="closeModal()"></app-login>